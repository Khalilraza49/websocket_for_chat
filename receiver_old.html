<!DOCTYPE html>
<html>
<head>
    <title>Message Receiver</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        #status { color: #666; margin-bottom: 10px; }
        #chat-box { height: 400px; border: 1px solid #ddd; padding: 10px; overflow-y: scroll; }
        .message { margin: 10px 0; padding: 8px 12px; border-radius: 5px; background: #f1f1f1; }
        .media { max-width: 200px; margin-top: 5px; }
        img, video { max-width: 100%; }
    </style>
</head>
<body>
    <h1>Incoming Messages</h1>
    <div id="status">Waiting for messages...</div>
    <div id="chat-box"></div>

    <script>
        // Configuration - replace with your actual values
        const EC2_IP = "107.22.158.136";
        const WS_PORT = 5000;
        const RECIPIENT_ID = 232; // Must match the receiver ID from sender page
        
        // Connect to WebSocket
        const socket = io(`http://${EC2_IP}:${WS_PORT}`, {
            query: {
                token: "90c04994-b3d4-4663-9f75-d6733e40cc47" // Replace with actual token
            }
        });

        // DOM elements
        const statusEl = document.getElementById('status');
        const chatBox = document.getElementById('chat-box');

        // Connection events
        socket.on('connect', () => {
            statusEl.textContent = `Connected - waiting for messages (User ${RECIPIENT_ID})`;
            statusEl.style.color = "green";
        });

        socket.on('disconnect', () => {
            statusEl.textContent = "Disconnected - trying to reconnect...";
            statusEl.style.color = "red";
        });

        // Receive messages
       socket.emit('join', { user_id: RECIPIENT_ID });
	socket.on('receive_message', (message) => {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const senderEl = document.createElement('div');
            senderEl.textContent = `From: User ${message.sender_id}`;
            senderEl.style.fontWeight = 'bold';
            
            const contentEl = document.createElement('div');
            contentEl.textContent = message.content;
            
            messageDiv.appendChild(senderEl);
            messageDiv.appendChild(contentEl);

            // Display media if attachment exists
            if (message.attachment_name) {
                const mediaDiv = document.createElement('div');
                mediaDiv.className = 'media';
                
                if (message.mime_type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = message.content;
                    mediaDiv.appendChild(img);
                } else if (message.mime_type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = message.content;
                    video.controls = true;
                    mediaDiv.appendChild(video);
                } else {
                    const link = document.createElement('a');
                    link.href = message.content;
                    link.textContent = message.attachment_name;
                    link.target = '_blank';
                    mediaDiv.appendChild(link);
                }
                
                messageDiv.appendChild(mediaDiv);
            }

            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            
            // Send read receipt (optional)
            if (message.id) {
                socket.emit('mark_as_read', { message_id: message.id });
            }
        });
    </script>
</body>
</html>
